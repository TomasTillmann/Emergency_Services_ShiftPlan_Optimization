\chapter{Převedení na optimalizační úlohu}

\section{Formalizace problému}

Ústředním problémem pohotovostních služeb je umět naplánovat týmy záchranářů a záchranná vozidla na výjezdové stanice tak, aby úspěšně obsloužili co největší počet incidentů,
za co nejméně zbytečně vynaložených nákladů.
Našim cílem je vymyslet metody jak být schopný taková optimální naplánovaní nalézt.
Z toho důvodu je v první řadě potřeba si problém zformalizovat a jasně si tak vymezit, jaký konkrétní problém řešíme.
\\
\\
Pohotovostní služba má k dispozici týmy záchranářů $Z = \{ z_1, z_2, \dots, z_{Z_n} \}$, pohotovostní vozidla $A = \{ a_1, a_2, \dots\ a_{A_n} \}$ a výjezdové stanice $V = \{ v_1, v_2, \dots, v_{V_n} \}$.
Pohotovostní služba definuje pracovní směny týmů záchranářů $D = D_{1} \times D_{2}$, 
kde $D_{1} \in \mathbb{N}_0$ množina začátků a $D_{2} \in \mathbb{N}_0$ množina délek směn v sekundách.
Směna $d \in D$ je tak dvojice $d = (d_1, d_2)$, kde $d_{1} \in D_{1}$ značí začátek a $d_{2} \in D_{2}$ délku trvání pracovní směny v sekundách.
\\
\\
Neformálně je plán pohotovostní služby přiřazení týmů záchranářů $z \in Z$ a záchranných vozidel $a \in A$ na konkrétní výjezdové stanice $v \in V$
a přiřazení pracovní směny $d \in D$ každému týmu záchranářů $z \in Z$ v rámci jednoho dne.
Tato přiřazení popíšeme funkcemi, 

\begin{definice}[Přiřazovací funkce]
  \begin{align}
    p_Z \colon Z &\rightarrow V \cup \{ v_{\emptyset} \}                   \hspace{65pt} \text{přiřazení týmů na stanice} \\
    p_A \colon A &\rightarrow V \cup \{ v_{\emptyset} \}                   \hspace{65pt} \text{přiřazení vozidel na stanice} \\ 
    p_{D_{1}} \colon Z &\rightarrow D_{1} \cup \{ d_{\emptyset} \}         \hspace{60pt} \text{přiřazení začátku směn týmům} \\
    p_{D_{2}} \colon Z &\rightarrow D_{2} \cup \{ d_{\emptyset} \}         \hspace{60pt} \text{přiřazení délky směn týmům}
  \end{align}
  \\
  Pokud $z \in Z$ nemá mít přiřazenou žádnou výjezdovou stanici,
  tak $p_{Z}(z) = v_{\emptyset}, p_{D_{1}} = d_{\emptyset}, p_{D_{2}} = d_{\emptyset}$.
  Pokud $a \in A$ nemá mít přiřazenou žádnou výjezdovou stanici, tak $p_{A}(a) = a_{\emptyset}$.
\end{definice}

\clearpage

\begin{definice}[Plán pohotovostní služby]
  Nechť vektory, $Z^{p}_z \in V^{Z_n}, A^{p} \in V^{A_n}, Z^{p}_{D_1} \in D_{1}^{Z_n}, Z^{p}_{D_2} \in {D_2}^{Z_n}$, kde
  \begin{align}
    {Z^{p}_z}_{(i)} &= p_Z(z), \hspace{40pt} &1 \leq i \leq Z_n \\
    A^{p}_{(i)} &= p_A(a), \hspace{40pt} &1 \leq i \leq A_n \\
    {Z^{p}_{D_1}}_{(i)} &= p_{D_1}(z), \hspace{40pt} &1 \leq i \leq Z_n \\
    {Z^{p}_{D_2}}_{(i)} &= p_{D_2}(z), \hspace{40pt} &1 \leq i \leq Z_n,
  \end{align}
  \\
  pak plán pohotovostní služby je čtveřice $p = (Z^{p}_z, A^{p}, Z^{p}_{D_1}, Z^{p}_{D_2}) \in P$, kde $P$ je prostor plánů pohotovostních služeb.
  \\
\end{definice}

Plán pohotovostní služby je jen zakódování \textit{přiřazovacích funkcí} %TODO odkaz?
do čtveřice vektorů.
\\
\\
Pohotovostní služba dále definuje omezení $C = \{ C_Z, C_A \}$, kde $C_Z$ je maximální dovolený počet $z \in Z$ na libovolné $v \in V$
a $C_A$ je maximální dovolený počet $a \in A$ na libovolné $v \in V$.



Problém, který v této práci řešíme, je nalézt $p_C \in P_C$, takové, že úspěšně odbaví co největší počet incidentů za co nejmenší cenu plánu.
Co je úspěšně odbavený incident a jakým způsobem zjistíme kolik incidentů plán úspěšně odbaví je detailně popisováno v kapitole Simulace plánu pohotovnostní služby (odkaz).
Jak zjistíme cenu plánu je popsáno (odkaz).
Formalizace optimalizační úlohy je popsána (odkaz).

\section{Simulace plánu pohotovostní služby}

\subsection{Proč simulace?}

Našim cílem je umět nalézt nejoptimálnější plán pohotovostní služby.
Ten určujeme podle co největšího počtu úspěšně odbavených incidentů a ceny plánu.
Z toho důvodu jsme si formálně nadefinovali protředky, které má pohotovostní služba k dispozici a co je plán pohotovostní služby.
Nyní potřebujeme způsob, jakým zjistíme počet úspěšně odbavených incidentů $S_{pI}$ pohotovostního plánu $p$ na množine incidentů $I$.
Pro zjištění $S_{pI}$ spustíme simulaci $S$ pohotovostního plánu $p$ na množině $I$.
Následně formálně popíšeme jaký typ simulace a jaká pravidla chodu simulace se rozhodneme použít. %TODO odkazy
\\
\\
Je velmi důležité, aby počet úspěšně odbavených incidentů $S_{pI}$ získaných simulací co nejvíce odpovídal počtu úspěšně odbavených incidentů,
kdyby byl použit $p$ v reálném světě a v průběhu dne by se přesně děly incidenty $I$.
Není lepší způsob jak získat co nejdůvěryhodnější $S_{pI}$ než spustit simulaci, která bude co nejvíce odpovídat chování plánu v reálném světě.
\\
\\
Přístup použití simulace má ještě jednu podstatnou výhodu.
Různé pohotovostní služby mohou používat různé způsoby a pravidla, například pro výběr záchranného týmu a vozidla pro odbavení incidentu co právě nastal, nebo do jaké nemocnice incident odbavit.
Tato pravidla můžou být příliš složitá, aby je bylo možné výstižně zachytit jinými způsoby, jako například pouze matematickými rovnostmi a nerovnostmi, jak je zvykem pro lineární programování.
Simulace tak nabízí vysokou flexibilitu.
%TODO, odkaz na linearni programovani kde vice popisu%
\\
\\
Avšak podstatnou nevýhodou simulace je její výpočetní náročnost a poměrně značné omezení použitelných technik obecně využívané pro řešení optimalizačních problémů. %TODO odkaz na optimalizacni ulohu.

\subsection{Definice diskrétní simulace}

\textit{Simulace} je imitace operací nějakého procesu nebo systému z reálného světa v průběhu časového úseku. (Discrete event simulation system simulation) %TODO cituj.
\textit{Systém simulace} je chápan jako dobře definovaná kolekce objektů a interakcí mezi nimi. (cituj ) % https://books.google.cz/books?hl=en&lr=&id=3seWwhxuGhsC&oi=fnd&pg=PA1&dq=discrete+event+simulation+model&ots=L3EkFOZNPK&sig=XrvmwmLnN7SLY0vLla_9yt5-C9Y&redir_esc=y#v=onepage&q=discrete%20event%20simulation%20model&f=false
% strana 2
Simulace si držuje \textit{stav systému}. Ten definuje jak se má simulace chovat.
Systém simulace se může měnit průběhem simulace nebo při nastání \textit{události}.
\\
\\
Simulace obecně dělíme na \textit{spojité} a \textit{diskrétní}.
V \textit{spojité simulaci} se změny systému dějí kontinuálně v průběhu běhu simulace, nejčastěji podle soustavy diferenciálních rovnic.
V \textit{diskrétní simulaci} se změny sytému dějí v diskrétních časoých úsecích, nejčastěji v čase nastání nějaké \textit{události}.
Klasický způsob jak diskrétní simulace probíhá je následovný.
Simulace odbavuje údalosti v pořadí nastání v čase.
Při inicializaci si naplánuje nějaké údalosti.
Při odbavování události aktualizuje stav systému podle předchozího stavu systému a aktuálně odbavované události. Zároveň si simulace náplanuje další události. 
Simulace skončí jakmile nejsou žádné další události k odbavení.
\\
\\
Dále dělíme simulace na \textit{deterministcké} a \textit{stochastické}.
V \textit{deterministické simulaci} jsme schopni z aktuálního stavu systému a údalosti deterministicky určit nadcházející stav systému.
V \textit{stochastické simulaci} nejsme schopni z aktuálního stavu systému a údalosti deterministicky určit nadcházející stav systému.
Většinou proto, že při výběru nadhcázejícího stavu figuruje element náhody.

\clearpage

\subsection{Popis simulace plánu pohotovostní služby}

Definujme simulaci pohotovostního plánu $p \in P_C$ na množině incidentů $I$ jako deterministickou diskrétní simulaci
$S \colon (p_C, I) \rightarrow \mathbb{N}_0$, kde vstupem je plán $p_C \in P_C$ a množina incidentů $I$.
Simulace vrátí počet úspěšně odbavených incidentů $S_{pI} \colon 0 \leq S_{pI} \leq |I|$.
Událost je nastání incidentu $i \in I$ v čase $T_I(i)$, kde $T_I \colon I \rightarrow \mathbb{N}_0$, určuje čas nastání incidentu.
Stav systému simulace $S$ je množina $S_S = \{ S_A, S_Z \}$, kde $S_A$ je stav záchranných vozidel $A$ a $S_Z$ je stav týmů záchranářů $Z$. 

\begin{algorithm}
  \begin{algorithmic}[1]  % [1] způsobí, že číslujeme kroky algoritmu
  \Function{Simulation}{$p_C, I$}
    \State $S_{pI} \gets 0$
    \State $T$ \gets 0
    \State $I' \gets \mbox{Setřídí $I$ podle času nastání, pomocí $T_I$}$
    \State $S_A \gets \mbox{Inicializuje podle $p_C$}$
    \State $S_Z \gets \mbox{Inicializuje podle $p_C$}$
    \For{$i_k \in I',~ k \in \{1, 2, \dots , |I|\}$}
      \State $T \gets \mbox{Čas nastání $i_k$, $T_I(i_k)$}$
      \State $z_k \gets \mbox{GetBestTeam($i_k, S_A, S_Z, T$)}$
      \If{$z_k \neq \emptyset$}
        \State $S_{pI} \gets S_{pI} + 1$
        \State $a_k \gets \mbox{GetBestAmbulance($z_k, T$)}$
        \State Naplánuj($z_k, a_k, i_k$)
        \State $S_A \gets \mbox{Update($S_A, i_k$)}$
        \State $S_Z \gets \mbox{Update($S_Z, i_k$)}$
      \EndIf
    \EndFor
    \State \Return $S_{pI}$
  \EndFunction
  \end{algorithmic}
\end{algorithm}
\vspace*{25px}

Průběh simulace je následovný. 
První simulace položí $S_{pI}$ a $T$ rovno nule.
Následně si setřídí sadu incidentů podle časů nastání a incicializuje si stavy $S_A$ a $S_Z$ podle plánu $p_C$.
Dále simulace odbavuje události, takže se pohybuje po těchto časech od nejdřívějšího až po poslední incident.
V každém kroku simulace $k \in \{ 1, 2, \dots , |I|\}$ se první pokusí deterministicky nalézt nejvhodnější $z_k \in Z$, který obslouží $i_k$. 
Pokud takový $z_k$ neexistuje, tak pokračuje v odbavování dalších incidentů.
Pokud existuje, zvýší počet odbavených incidentů $S_{pI}$ o jedna, nalezne pro $z_k$ nejvhodnější $a_k$, $i_k$ naplánuje na $z_k$ spolu s $a_k$ a aktualizuje stav systému $S_A$ a $S_Z$.
Simulace doběhne jakmile nejsou žádné další události k odbavení, takže jakmile projde všechny incidenty, to je po $|I|$ krocích, a vrátí $S_{pI}$.
\\
\\
Nyní si ukažme, jakým způsobem je nalezen nejvhodnější tým záchranářů $z_k$ pro obsloužení $i_k$. K tomu si potřebujeme definovat co znamená,
že tým záchranářů je schopen úspěšně odbavit incident a jakým způsobem pak vybere ze všech takových týmu ten nejvhodnější.

\clearpage

\begin{definice}
  Tým záchranářů $z \in Z$ je schopen úspěšně odbavit incident $i \in I$ právě tehdy když:

  \begin{enumerate}
    \item
      Je alokován a má přiřazenou směnu. Pokud tým záchranářu není alokován na žádnou výjezdovou stanici nebo nemá přiřazenou směnu, tak samozřejmě není schopen obsloužit $i$.
      Formálně, $p_{Z_C} \neq 0 \land p_{D_C} \neq (d_1, d_2) \in D, d_2 = 0$.

    \item
      Tým je schopen dorazit na místo incidentu do požadované doby.
      Ať už přímo z výjezdové stanice, nebo při vrácení se po vyřízení incidentu zpět na výjezdovou stanici. 
      V prvním případě tým potřebuje mít na výjezdové stanici k dispozi volné záchranné vozidlo. V druhém případě už záchranné vozidlo k dispozici má.

    \item
      Týmu nekončí směna dříve, než je očekávaný konec celkové doby vyřízení incidentu.
  \end{enumerate}
\end{definice}


\begin{definice}
  Nejvhodnější tým záchranářů $z_k \in Z_k$, kde $Z_k \subseteq Z$ jsou všechny týmy záchranářů schopny úspěšně odbavit incident $i_k \in I$ je tým,
  který je nejlepší podle následujícíh kritérií v daném pořadí:

  \begin{enumerate}
    \item Upřednostni tým, který je na výjezdové stanici před týmem, který ukončuje vyřízení jednoho z předchozích incidentů. 
    \item Upřednostni tým, který na místo incidentu dorazí dříve. 
    \item Upřednostni tým, který již obsloužil méně incidentů a je tedy méně vyčerpaný.
  \end{enumerate}
\end{definice}

Funkce \textbf{GetBestTeam} vrací tým záchranářu $z_k$ z týmů záchranářů $Z_k$, kteří jsou schopni úspěšně odbavit incident $i_k$, podle (Definice 1)
, kde $z_k$ je nejvhodnější pro obsloužení incidentu $i_k$ ze $Z_k$ podle definice 2. %TODO odkaz
Funkce \textbf{GetBestAmbulance} vybere záchranné vozidlo, které je na stejné výjezdové stanici jako $z_k$ a časově je nejdříve k dispozici.
%TODO jak odkazat do kodu?
\\
\\
Pravidla jsou navrhnuta tak, aby práce obsluhování incidentů byla rozmístěna rovnoměrně přes všechny týmy, ale aby zároveň byly incidenty obslouženy nejrychleji jak je možné.
Třetí pravidlo pro výběr nejvhodnějšího týmu zaručuje rovnoměrnost práce a druhé co nejrychlejší obsloužení incidentu.
Pravidla také počítají s možným zpožděním a raději upřednostní tým, který je aktuálně k dispozici, než tým, který ještě dokončuje jiný incident, ale mohl by i na místě incidentu
být dříve, pokud by neměl zpoždění. Příkladem je první pravidlo pro výběr nejvhodnějšího týmu.
\\
\\
V naší simulaci jsou použitá pravidla vybraná na základě konzultace se společností, která se danou problematikou zabývá přes 25 let a sami podobná pravidla používají pro plánovaní sanitek
u několika jejich klientů ve Spojených státech.
Není však problém naimplementovat pravidla zcela jiná, jednodušší, komplikovanější nebo klidně i stochastická.

\section{Převedení problému na optimalizační úlohu s více účelovými funkcemi}

\begin{definice}[Optimalizační úloha s jednou účelovou funkcí]
  \begin{align}
    \max_{x} q(x), \hspace{50pt} x \in \mathcal{X},
  \end{align}
  \\
  kde $\mathcal{X}$ je prostor všech možných konfigurací.
\end{definice}

Za \textit{řešení} optimalizační úlohy se považuje optimální konfigurace $x^* \in \mathcal{X}$, kde $q(x^*)$ je globální maximum $q$.
Funkce $q$ je účelová funkce, a její návrh zásadně ovlivní jaké $x^*$ je optimální. 
\\
\begin{definice}[Optimalizační úloha s více účelovými funkcemi]
  \begin{align}
    \max_{x} q(x), \hspace{50pt} &x \in \mathcal{X}, \\
                                 &q(x) = [q_1(x), q_2(x), \dots q_{m}(x)], q_i \in \mathcal{Q}, \\
                                 &0 \leq i \leq m, m = |\mathcal{Q}| 
  \end{align}
  \\
  kde $\mathcal{X}$ je prostor všech možných konfigurací a $\mathcal{Q}$ je vektor účelových funkcí, které chceme maximalizovat.
  Funkci $q(x)$ maximalizujeme po složkách.
  Bez újmy na obecnosti můžeme účelové funkce maximalizovat, protože
  \begin{align}
    \min_{x} q(x) \equiv \max_{x} -q(x)
  \end{align}
  .
\end{definice}

Z definice je optimální konfigurací $x^* \in \mathcal{X}$ takzvaný \textit{utopia point} $y^{utopia}$.
To je konfigurace, která nabývá optima pro každou jednotlivou účelovou funkci.
Zřejmě $y^{utopia}$ nemusí existovat, protože často maximalizování $q_i \in \mathcal{Q}$ může minimalizovat $q_j \in \mathcal{Q}, q_i \neq q_j$.
Jak optima, která alespoň existují, hledat pro optimalizační úlohu s více účelovými funkcemi je probíráno (odkaz). %TODO ODKAZ.
\\
\\
Již z úvodu víme, že chceme nalézt takový plán $p_C \in P_C$, který úspěšně odbaví co nejvíce incidentů za co nejmenší cenu plánu.
Díky simulaci $S$ jsme pro $p_C$ schopni zjistit počet úspěšně odbavených incientů $S_{pI}$, potřebujeme ještě dodefinovat cenu plánu.
\\
\begin{definice}[Cena plánu]
  Cena plánu $G \colon P_C \rightarrow \mathbb{R}$,

  \begin{align}
    G(p_C) = \sum_{(d_1, d_2) = p_{D_C}(z), z \in Z} d_2 / 60 + |p_{A_C}(a) \neq v_{\emptyset}|
  \end{align}
  .
  \\
  \\
  Cena plánu je součet všech dob trvání směn přiřazených záchranným týmům v minutách a počtu naalokovaných záchranných vozidel.
\end{definice}

Nadefinujme optimalizační úlohu nalezení optimálního plánu pohotovostní služby, jako
\\
\begin{definice}[Optimalizační úloha nalezení optimálního plánu pohotovostní služby jako optimalizační úloha s více účelovými funkcemi]
  \begin{align}
    \max_{p} q(p), \hspace{50pt} p \in P_C, q(p) = [S(p, I), -G(p)]
  \end{align}
  \\
  kde $P_C$ je množina všech povolných plánu pohotovostní služby podle omezení $C$ a $I$ je daná množina incidentů.
\end{definice}

Problém nalezení optimálního plánu pohotovostní služby jsme klasifikovali jako optimalizační úlohu s více účelovými funkcemi.
Účelové funkce jsou počet úspěšně odbavených incidentů $S(p, I)$ a záporná cena plánu pohotovostní služby $G(p)$.
Všimněmě si, že maximalizování $S$ bude velmi pravděpodobně vést k maximalizování $G$, tedy k minimalizování $-G$.
Plány úspěšně odbavující incidenty zřejmě budou používát více záchranných týmu s delšími směnami a více záchranných vozidel, takže budou dražší.

\section{Metody pro řešení optimalizačního problému s více účelovými funkcemi}

Klasifikovali jsme problém nalezení optimálního plánu pohotovostní služby jako optimalizační úlohu s více účelovými funkcemi.
Zároveň účelové funkce jsou protichůdné. Maximalizováním $S$ minimalizujeme $-G$ a naopak.
Optimalizační úlohy s více účelovými funkcemi, mezi kterými je potřeba nalézt kompromis pro nalezení optima, jsou velmi časté,
a proto existuje několik metod, které se v takovém případě používají.
Většina metod převede víceúčelovou funkci na jednu účelovou funkci.
Vybrané metody si ukážeme a rozmyslíme si, které budeme preferovat. 

\subsection{Omezující metoda}

\begin{definice}
  Omezující metoda omezí všechny až na jednu účelovou funkci. Bez újmy na obecnosti vyberme $q_1$:
  \begin{align*}
    \max_{x \in \mathcal{X}} q_1(x)
  \end{align*}

  \begin{align}
    \text{kde platí: } q_2(x) \leq c_2, q_3(x) \leq c_3, \dots, q_m(x) \leq c_m,
  \end{align}
  pro $c \in \mathbb{R}^m$.
  \\
\end{definice}

%TODO nevim co tu napsat vubec

\subsection{Vážená suma účelových funkcí}

Jedná se o způsob převedení víceúčelové funkce pouze na jednu účelovou funkci pomocí sumy účelových funkcí pronásobené váhami.

\begin{definice}[Vážená suma účelových funkcí]
  \begin{align}
    q'(x) = w^T q(x),
  \end{align}
  kde $w \in \mathbb{R}^m$ je vektor vah.
  \\
\end{definice}

Vzhledem k tomu, že chceme jistě upřednostňovat $S(p, I)$ nad $G(p)$, vážená suma účelových funkcí, tak patří mezi preferované metody.

\begin{definice}[Vážená suma účelových funkcí optimalizace pohotovostního plánu]
  \begin{align}
    q_{\alpha}(p) = \alpha \cdot S(p, I) - (1 - \alpha) \cdot G(p), \hspace{50pt} \alpha \in [0, 1], p \in P_C
  \end{align}
  \\
\end{definice}

Parametr $\alpha$ bychom tak preferovali blíže jedné, pro upřednostnění $S_{pI}$ a pro upřednostnění $G(p)$ blíže nule.

\subsection{Goal programming}

Jedná se o způsob převedení víceúčelové funkce pouze na jednu účelovou funkci minimalizováním vzdálenosti od nějaké ideální hodnoty - cíle. 

\begin{definice}[Účelová funkce měřící vzdálenost od cíle]
  \begin{align}
    \min_{x \in \mathcal{X}} \| q(x) - y^{goal} \|, \hspace{50pt} y^{goal} \in \mathbb{R}
  \end{align}
  \\
\end{definice}

Standardně $y^{goal} = y^{utopia}$.
Pro pohotovostní plány $y^{utopia} = [1, 0]$, úspěšné odbavení všech incidentů za nulovou cenu.
Samozřejmě $y^{utopia}$ v $P_C$ nemůže existovat.
Nulovou cenu má pouze plán, kde není naalokován žádný tým záchranářů ani záchranné vozidlo a takový plán nemůže úspěšně obsloužit žádný incident. 
Můžeme však měřit, jak blízko $p$ k $y^{utopia}$ je.

\begin{definice}[Goal programming pro optimalizaci pohotovostního plánu]
  \begin{align}
    q^{goal}(p) = \| [1 - S(p, I), G(p)] \|
  \end{align}
  \\
\end{definice}

Nevýhodou tohoto přístupu je neschopnost určit kterou účelovou funkci je důležitější optimalizovat.

\subsection{Vážená exponenciální suma účelových funkcí}

\begin{definice}[Vážená exponenciální suma účelových funkcí]
  \begin{align}
    q(x) = \sum_{i=1}^{m} w_i (q_i(x) - y_i^{goal})^p,
  \end{align}
  kde $w \in \mathbb{R}^m, p \in \mathbb{R}$.
  \\
\end{definice}

Jedná se o kombinaci goal programming a vážené sumy účelových funkcí.
Váhami $w$ jsme schopni určit, kterou účelovou funkci je pro nás důležitější optimalizovat. Pro pohotovostní plány:

\begin{definice}[Vážená exponenciální suma účelových funkcí pro pohotovostní plány]
  \begin{align}
    q(x)_{\alpha p} = (1 - \alpha \cdot S(p, I))^p + ((1 - \alpha) \cdot G(p))^p,
  \end{align}
  \\
\end{definice}

Stejně jako (odkaz) jsme díky parametru $\alpha$ schopni upřednostit maximalizování $S(p, I)$ nad $-G(p)$.

\subsection{Paretova optimalita}

\begin{definice}[Dominance]
  Konfigurace $x \in \mathcal{X}$ dominuje $x' \in \mathcal{X}$, právě tedhy když
  \begin{align}
    q_i(x') \leq q_i(x) \land q_j(x') < q_j(x)
  \end{align}
  \\
$\forall i \in \{ 1, \dots, m \}, \exists j \in \{ 1, \dots, m \}$.
\\
\end{definice}

\begin{definice}[Pareto optimální]
  Konfigurace $x$ je pareto optimální, právě tehdy když, neexistuje $x'$, které by dominovalo $x$.
  \\
\end{definice}

\begin{definice}[Paretova hranice]
  Jsou všechny konfigurace $x$, které jsou Pareto optimální.
  \\
\end{definice}

Optimální plán pohotovostní služby podle paretovy optimality by pak byl libovolný plán na Paretově hranici.
Přístup Paretovy optimality je vhodný, pokud zlepšení v jedné účelové funkci vede k zhoršení v ostatních a není jasné, jakou účelovou funkci upřednostit.
My ale víme, jakou účelovou funkci chceme upřednostnit.
Také si všimněme, že přístup Paretovy optimality nepřevádí víceúčelovou funkci na jednu účelovou funkci,
nýbrž definuje optimální konfiguraci při více účelových funkcích. 
Z těchto důvodu přístup Paretovy optimality pro nás nebude příliš zajímavý.
Věnujeme se mu pouze v kapitole o genetickách algoritmech (odkaz), protože je vhodná při použití populačních metod.

\section{Převedení problému na optimalizační úlohu s jednou účelovou funkcí}

V předchozí kapitole jsme si ukázali několik přístupů, které vhodně převedou víceúčelovou funkci na jednu účelovou funkci.
Pohotovostní služby chtějí vždy upřednostňovat maximalizování $S(p, I)$ nad minimalizováním $G(p)$,
z toho důvodu je pro nás velmi žádoucí, abychom byli schopni pro účelovou funkci určit, zda chceme a jak moc upřednostit maximalizování $S(p, I)$ nebo $-G(p)$.
Upřednostníme pak maximalizování $S(p, I)$.
Vážená suma účelových funkcí $q_{\alpha}$ spolu s váženou exponenciální sumou účelových $q_{\alpha p}$ funkcí tak patří mezi preferované způsoby návrhu jedné účelové funkce.

\begin{definice}[Optimalizační úloha nalezení optimálního plánu pohotovostní služby jako optimalizační úloha s jednou účelovou funkcí]
  \begin{align}
    \max_{p} q(p), \hspace{50pt} p \in P_C, q \in Q 
  \end{align}
  \\
  kde $P_C$ je množina všech povolných plánu pohotovostní služby podle omezení $C$, $I$ je daná množina incidentů a $Q = \{ q_{\alpha}, q_{\alpha p}\}$ množina preferovaných účelových funkcí.
\end{definice}

\section{Klasifikace optimalizační úlohy}



Jedná se o diskrétní kombinatorickou optimalizaci s omezujícími podmínkami $C$, kde víceúčelová funkce $q_I$ pro výpočet kvality plánu používá úspěšnost
odbavení incidentů $s_pI$ a cenu $c_pI$ plánu, pronásobené váhami $\alpha, \beta \in [0, 1]$,
přičemž pro získání $s_pI$ pro $p \in P_C$ a $I$ je nutné spustit simulaci $S_I$.
Funkce $S_I$ nemá žádný matematický předpis, z toho důvodu $q_I$ není derivovatelná.
Nemůže tak splňovat podmínky optimalizace prvního (1.5) ani druhého řádu (1.6) %TODO cituj a odkaz

\begin{align}
  &\nabla q_I(p^*) = 0 \\
  &\nabla^2 q_I(p^*) \hspace{50pt} \text{je positivně semidefinitní}
\end{align}
.
\\
\\
Z toho plyne, že pro nalezení optima nelze použít žádné metody prvního ani druhého řádu. %TODO cituj
Na víceúčelovou funkci $q_I$ můžeme pouze nahlížet jako na černou skříňku %TODO neni neformalni?
, ze které jedině můžeme získávat vzorky v diskrétních bodech.
Zřejmě nemůžeme navzorkovat $q_I$ přes všechny $p \in P_C$ a vybrat z nich maximum, protože obecně $P_C$ je příliš velká.
Kokrétně, velikost $P_C$ se odvíjí od počtu výjezdových stanic $v = |V|$, počtu záchranných vozidel $a = |A|$, počtu záchranných týmů $z = |Z|$, počtu možných směn $d = |D'|$, 
maximálního počtu týmů na stanici $c_z$ a maximálního počtu sanitek na stanici $c_a$.

\begin{align}
  \sum_{i=0}^{z}{d^{v \cdot c_z \choose z - i}} \cdot \sum_{i = 0}^{a}{v \cdot c_a \choose a - i}
\end{align}
\\
\\
Toto (1.7) %odkaz
přesně odpovídá velikosti prostoru dovolených plánu $P_C$. Vybíráme ($z-i$)-tice přes počet stanic a dovolený počet týmů na stanici, a ještě každému týmu
přiřadíme směnu, kterých je $d$. Pro každé takové rozmístění týmů ještě potřebujeme vybrat rozmístění záchranných vozidel.
Způsob výběru je stejný, akorát nepočítáme přiřazení směny.

\clearpage

Odhadneme,

\begin{align*}
  \sum_{i=0}^{z}{d^{v \cdot c_z \choose z - i}} \cdot \sum_{i = 0}^{a}{v \cdot c_a \choose a - i}
  &< z \cdot d^{\left( \frac{v \cdot c_z \cdot 2^{v \cdot c_z}}{e} \right)} \cdot a \cdot {\frac{v \cdot c_a \cdot 2^{v \cdot c_a}}{e}}\\
  &< z \cdot d^{v \cdot c_z \cdot 2^{v \cdot c_z}} \cdot a \cdot {v \cdot c_a \cdot 2^{v \cdot c_a}}\\
  &\sim \mathcal{O}(z \cdot d^{v \cdot 2^v} \cdot av \cdot 2^v)\\
\end{align*}
.
\\
\\
Použitím odhadu kombinačního čísla prostředním, největším, kombinačním číslem přes sčítání velikosti disjunktních množin a následnými úpravami,
dostaneme, že $|P_C| \sim \mathcal{O}(z \cdot d^{v \cdot 2^v} \cdot av \cdot 2^v)$.
Na $c_z$ a $c_a$ nahlížíme jako na konstanty, protože v praxi se o konstanty jedná. Jedná se o řádově těsný odhad, takže jistě existuje $c_1$, aby $|P_C| \sim \Omega(z \cdot d^{v \cdot 2^v} \cdot av \cdot 2^v)$.
Takže 

\begin{align*}
  |P_C| \sim \Theta{(z \cdot d^{v \cdot 2^v} \cdot av \cdot 2^v)}
\end{align*}
.
\\
\\
Prostor plánu je exponenciálně velký vůči násobku počtu výjezdových stanic $v$ a počtu možných směn $d$.
\\
\\
Časová složitost běhu jedné simulace pro množinu incidentů $I$ je $\sim \Theta{(|I| \cdot z \cdot c_a})$.
Potřebujeme pro každý incident nalézt nejvhodnější tým a pro daný tým nejvhodnější záchranné vozidlo na výjezdové stanici, kde se tým nachází.
\\
\\
Časová složitost přeiterování přes všechny plány a spuštění simulace je

$$
  \Theta{(z \cdot d^{v \cdot 2^v} \cdot av \cdot 2^v \cdot |I| \cdot z \cdot c_a)}
$$
.
\\
\\
Zřejmě tedy nelze naivně zkusit spustit simulaci pro každý plán $p \in P_C$, držet si $p^*$ s maximální hodnotou účelové funkce a tak najít nejkvalitnější plán.
\\
\\
Dále, nelze ani v rozumném čase zjistit maximální kvalitu plánu, protože ani nelze v rozumném čase zjistit maximální možnou úspěšnost.
Uvažme množinu plánů $P_{max} \subseteq P_C$, obsahující pouze plány s maximální délkou směny $d_{max} \in D$ a uvažme sitauci kdy máme dostatek záchranných týmů i vozidel,
takže na každé výjezdové stanici jich máme maximální počet.
\\
\\
Nechť $p*_{max} \in P_{max}$, $S_{I}(p*_{max}) = s_{max}$.
Pokud $\forall p_{max} \in P_{max} \colon S_{pI}(p_{max}) \leq s_{max}$, pak jistě $\forall p \in P_C \colon S_{pI}(p) \leq s_{max}$.
Zřejmě pokud mezi plány s maximální délkou směny pro všechny týmy a maximálním počtem týmů a vozidel přes stanice nalezneme $s_{max}$,
pak se jedná i o maximální možnou úspěšnost přes všechny možné plány. S kratšími délkami směn si pomůžeme se snížením ceny, avšak v úspěšnosti si můžeme jedině uškodit.
Jenže $|P_{max}| \geq d^z$. Hodnota $d$ se v praxi pohybuje kolem nižších desítek a $z$ nižších stovek,
takže očividně i velikost $P_{max}$ je prakticky příliš velká na lineární průchod a tak nalezení maxima.
Zároveň pokud $s'_{max}$ maximem $P'_{max} \subseteq P_{max}$, nemůžeme nikdy prohlásit za maximum $P_{max}$, protože vždy může existovat $p_{max}* \in P_{max} \setminus P'_{max}$ s vyšší kvalitou.
Čili $P_{max}$ je nejmenší možná množina kterou musíme proiterovat pro nalezení plánu s nejvyšší úspěšností s jistotou.
Z toho plyne, že nelze získat ani maximální kvalitu plánu, takže kvality plánu můžeme porovnávat pouze mezi sebou, nikoliv jak blízko jsou nejlepší možné kvalitě.

DDDDDDDDDDdddd
Definujme počet úspěšně odbavených incidentů, $S_c(p, I)$.
Definujme $S_s(p, I)$ jako procento úspěšně odbavených incidentů, tedy

\begin{align}
  S_s(p, I) = \frac{S_c(p, I)}{|I|}.
\end{align}
.
\\
\\
Celkové vynaložené náklady vyjádříme cenou plánu.
Nechť 

